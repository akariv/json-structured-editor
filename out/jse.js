// Generated by IcedCoffeeScript 1.2.0i
(function() {
  var JSE, JSEArray, JSEDate, JSENumber, JSEObject, JSESelect, JSEString, JSEText, JSEValue, generateJSEItem, iced,
    __slice = [].slice,
    __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor; child.__super__ = parent.prototype; return child; };

  iced = {
    Deferrals: (function() {

      function _Class(_arg) {
        this.continuation = _arg;
        this.count = 1;
        this.ret = null;
      }

      _Class.prototype._fulfill = function() {
        if (!--this.count) return this.continuation(this.ret);
      };

      _Class.prototype.defer = function(defer_params) {
        var _this = this;
        ++this.count;
        return function() {
          var inner_params, _ref;
          inner_params = 1 <= arguments.length ? __slice.call(arguments, 0) : [];
          if (defer_params != null) {
            if ((_ref = defer_params.assign_fn) != null) {
              _ref.apply(null, inner_params);
            }
          }
          return _this._fulfill();
        };
      };

      return _Class;

    })(),
    findDeferral: function() {
      return null;
    }
  };

  JSEValue = (function() {

    JSEValue.name = 'JSEValue';

    function JSEValue(optional, title, fixed) {
      this.optional = optional;
      this.title = title;
      this.fixed = fixed;
    }

    JSEValue.prototype.setvalue = function(value) {
      if (this.validate(value)) return this.value = value;
    };

    JSEValue.prototype.validate = function(value) {
      if (!(this.optional || (value != null))) {
        throw "JSE: Required mandatory value";
      }
      return (value != null) && value !== 'undefined';
    };

    JSEValue.prototype.getvalue = function() {
      return this.value;
    };

    return JSEValue;

  })();

  JSEString = (function(_super) {

    __extends(JSEString, _super);

    JSEString.name = 'JSEString';

    function JSEString(optional, title, fixed) {
      JSEString.__super__.constructor.call(this, optional, title, fixed);
    }

    JSEString.prototype.render = function(jselector) {
      jselector.append("<input type='text' class='input-xlarge' id='input01' placeholder='Enter something'>");
      this.el = jselector.find("input:last");
      if (this.value != null) this.el.val(this.value);
      if (this.fixed) {
        this.el.addClass("disabled");
        return this.el.attr("disabled", "");
      }
    };

    JSEString.prototype.validate = function(obj) {
      if (JSEString.__super__.validate.call(this, obj)) {
        if (!(typeof obj === "string")) {
          throw "JSE: Expected String value";
        } else {
          return true;
        }
      }
      return false;
    };

    JSEString.prototype.getvalue = function() {
      if (this.el) {
        if (this.el.val() !== "") {
          return this.el.val();
        } else {
          return null;
        }
      } else {
        return this.value;
      }
    };

    return JSEString;

  })(JSEValue);

  JSEText = (function(_super) {

    __extends(JSEText, _super);

    JSEText.name = 'JSEText';

    function JSEText() {
      return JSEText.__super__.constructor.apply(this, arguments);
    }

    JSEText.prototype.render = function(jselector) {
      jselector.append("<textarea class='input-xlarge' rows='3' placeholder='Enter something'>");
      this.el = jselector.find("textarea:last");
      if (this.value != null) this.el.val(this.value);
      if (this.fixed) return this.el.addClass("disabled");
    };

    return JSEText;

  })(JSEString);

  JSEDate = (function(_super) {

    __extends(JSEDate, _super);

    JSEDate.name = 'JSEDate';

    function JSEDate() {
      return JSEDate.__super__.constructor.apply(this, arguments);
    }

    JSEDate.prototype.render = function(jselector) {
      jselector.append("<input data-date-format='dd/mm/yyyy' value='01/01/2012' type='text' class='input-xlarge'>");
      this.el = jselector.find("input:last");
      this.el.datepicker({});
      if (this.value != null) this.el.val(this.value);
      if (this.fixed) return this.el.addClass("disabled");
    };

    return JSEDate;

  })(JSEString);

  JSESelect = (function(_super) {

    __extends(JSESelect, _super);

    JSESelect.name = 'JSESelect';

    function JSESelect(optional, title, options) {
      this.options = options;
      JSESelect.__super__.constructor.call(this, optional, title, false);
    }

    JSESelect.prototype.render = function(jselector) {
      var display, option, val, _i, _len, _ref;
      jselector.append("<select></select>");
      this.el = jselector.find("select:last");
      _ref = this.options;
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        option = _ref[_i];
        val = option[0], display = option[1];
        this.el.append("<option value='" + val + "'>" + display + "</option>");
      }
      if (this.value != null) return this.el.select(this.value);
    };

    return JSESelect;

  })(JSEString);

  JSENumber = (function(_super) {

    __extends(JSENumber, _super);

    JSENumber.name = 'JSENumber';

    function JSENumber(optional, title, fixed) {
      JSENumber.__super__.constructor.call(this, optional, title, fixed);
    }

    JSENumber.prototype.render = function(jselector) {
      jselector.append("<input type='text' class='input-xlarge' id='input01' placeholder='Enter something'>");
      this.el = jselector.find("input:last");
      if (this.value != null) this.el.val(this.value);
      if (this.fixed) return this.el.addClass("disabled");
    };

    JSENumber.prototype.validate = function(obj) {
      if (JSENumber.__super__.validate.call(this, obj)) {
        if (!(typeof obj === "number")) {
          throw "JSE: Expected Number value";
        } else {
          return true;
        }
      }
      return false;
    };

    JSENumber.prototype.getvalue = function() {
      if (this.el) {
        if (this.el.val() !== "") {
          return parseInt(this.el.val(), 10);
        } else {
          return null;
        }
      } else {
        return this.value;
      }
    };

    return JSENumber;

  })(JSEValue);

  JSEObject = (function(_super) {

    __extends(JSEObject, _super);

    JSEObject.name = 'JSEObject';

    function JSEObject(fields, optional, title) {
      var tuple, _i, _len;
      console.log("new object");
      JSEObject.__super__.constructor.call(this, optional, title, false);
      this.children = {};
      this.fieldnames = (function() {
        var _i, _len, _results;
        _results = [];
        for (_i = 0, _len = fields.length; _i < _len; _i++) {
          tuple = fields[_i];
          _results.push(tuple.name);
        }
        return _results;
      })();
      for (_i = 0, _len = fields.length; _i < _len; _i++) {
        tuple = fields[_i];
        this.children[tuple.name] = generateJSEItem(tuple.props);
      }
    }

    JSEObject.prototype.render = function(jselector) {
      var fieldname, title, _i, _len, _ref, _results;
      jselector.append("<form class='well form-horizontal'></form>");
      jselector = jselector.find("form:last");
      _ref = this.fieldnames;
      _results = [];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        fieldname = _ref[_i];
        title = this.children[fieldname].title;
        jselector.append("<div class='control-group'>                                               <label class='control-label'>" + title + "</label>                                               <div class='controls'>                                               </div>                                          </div>");
        _results.push(this.children[fieldname].render(jselector.find(".control-group:last > .controls")));
      }
      return _results;
    };

    JSEObject.prototype.validate = function(obj) {
      if (JSEObject.__super__.validate.call(this, obj)) {
        if (!(typeof obj === "object")) {
          throw "JSE: Expected Object value";
        } else {
          return true;
        }
      }
      return false;
    };

    JSEObject.prototype.setvalue = function(obj) {
      var fieldname, value, _i, _len, _ref, _results;
      if (this.validate(obj)) {
        _ref = this.fieldnames;
        _results = [];
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          fieldname = _ref[_i];
          value = obj[fieldname];
          _results.push(this.children[fieldname].setvalue(value));
        }
        return _results;
      }
    };

    JSEObject.prototype.getvalue = function() {
      var fieldname, r, _i, _len, _ref;
      r = {};
      _ref = this.fieldnames;
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        fieldname = _ref[_i];
        if (this.children[fieldname].getvalue() != null) {
          r[fieldname] = this.children[fieldname].getvalue();
        }
      }
      return r;
    };

    return JSEObject;

  })(JSEValue);

  JSEArray = (function(_super) {

    __extends(JSEArray, _super);

    JSEArray.name = 'JSEArray';

    function JSEArray(fielddesc, optional, title) {
      this.fielddesc = fielddesc;
      console.log("new array");
      JSEArray.__super__.constructor.call(this, optional, title, false);
      this.children = [];
    }

    JSEArray.prototype.render = function(jselector) {
      var child, _i, _len, _ref,
        _this = this;
      jselector.append("<div></div>                                  <a class='additem btn btn-mini'><i class='icon-plus'></i>New item</a>");
      this.el = jselector.find("div:last");
      _ref = this.children;
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        child = _ref[_i];
        child.render(this.el);
      }
      return jselector.find(".additem:last").click(function() {
        child = generateJSEItem(_this.fielddesc);
        _this.children.push(child);
        return child.render(_this.el);
      });
    };

    JSEArray.prototype.validate = function(obj) {
      if (JSEArray.__super__.validate.call(this, obj)) {
        if (!(typeof obj === "object")) {
          throw "JSE: Expected Array value";
        } else {
          return true;
        }
      }
      return false;
    };

    JSEArray.prototype.setvalue = function(obj) {
      var child, value, _i, _len, _results;
      if (this.validate(obj)) {
        this.children = [];
        _results = [];
        for (_i = 0, _len = obj.length; _i < _len; _i++) {
          value = obj[_i];
          child = generateJSEItem(this.fielddesc);
          child.setvalue(value);
          _results.push(this.children.push(child));
        }
        return _results;
      }
    };

    JSEArray.prototype.getvalue = function() {
      var el, _i, _len, _ref, _results;
      _ref = this.children;
      _results = [];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        el = _ref[_i];
        if (el.getvalue() != null) _results.push(el.getvalue());
      }
      return _results;
    };

    return JSEArray;

  })(JSEValue);

  generateJSEItem = function(fielddesc) {
    var children, eltype, fixed, optional, options, title, type;
    type = fielddesc["type"];
    optional = fielddesc["optional"] === true;
    children = fielddesc["children"];
    eltype = fielddesc["eltype"];
    title = fielddesc["title"];
    options = fielddesc["options"];
    fixed = fielddesc["fixed"];
    console.log("type: " + type);
    switch (type) {
      case "obj":
        return new JSEObject(children, optional, title);
      case "num":
        return new JSENumber(optional, title, fixed);
      case "str":
        return new JSEString(optional, title, fixed);
      case "select":
        return new JSESelect(optional, title, options);
      case "text":
        return new JSEText(optional, title, fixed);
      case "date":
        return new JSEDate(optional, title, fixed);
      case "arr":
        return new JSEArray(eltype, optional, title);
      default:
        throw "JSE: unknown type " + type;
    }
  };

  JSE = (function() {

    JSE.name = 'JSE';

    function JSE(selector, scheme) {
      this.selector = selector;
      this.scheme = scheme;
      this.jse = generateJSEItem(this.scheme);
      this.jse.render(this.selector);
    }

    JSE.prototype.setvalue = function(value) {
      return this.jse.setvalue(value);
    };

    JSE.prototype.getvalue = function() {
      return this.jse.getvalue();
    };

    JSE.prototype.render = function() {
      return this.jse.render(this.selector);
    };

    return JSE;

  })();

  window.JSE = JSE;

}).call(this);
